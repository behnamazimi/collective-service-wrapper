!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("JSServiceWrapper",[],t):"object"==typeof exports?exports.JSServiceWrapper=t():e.JSServiceWrapper=t()}(this,(function(){return function(e){var t={};function i(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(s,o,function(t){return e[t]}.bind(null,o));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/lib/",i(i.s=0)}([function(e,t,i){"use strict";i.r(t),i.d(t,"ServiceWrapper",(function(){return r})),i.d(t,"ClientHandler",(function(){return n})),i.d(t,"HOOKS",(function(){return o}));var s=(()=>{let e;return{getInstance:()=>(e||(e={_debugMode:!1,log(...e){this._debugMode&&console.log(...e)},set debugMode(e){this._debugMode=e},count:0,_requests:{},generateNewID(){return this.count++,this.count+"__"+Math.random().toString(32).substr(2).substr(6)},onTurn(e,t){this._requests[e]={...this._requests[e],listener:t,status:"pending"}},fire(e,...t){this._requests[e]&&"function"==typeof this._requests[e].listener&&(this.log(`* FIRED: ${e} [type: ${this._requests[e].status}]`),this._requests[e].status="fired",this._requests[e].listener.apply(this,t))},add(e={}){const t=this.generateNewID();return this._requests[t]=e,this.log("+ ADDED: "+t),t},checkIdleStatus(e,t=!1){return new Promise(i=>{if(this.onTurn(e,i),t)return this._requests[e].status="parallel",void this.fire(e);const s=Object.keys(this._requests);s.length&&s[0]!==e||this.fire(e)})},removeRequest(e){delete this._requests[e],this.log("- REMOVED: "+e);const t=Object.keys(this._requests),i=this._requests[t[0]];i&&"pending"===i.status&&this.fire(t[0])}}),e)}})();const o={BEFORE_RESOLVE:"before.resolve",BEFORE_REJECT:"before.reject",BEFORE_FIRE:"before.fire",AFTER_SUCCESS:"after.success",AFTER_FAIL:"after.fail",UPDATE_REQUEST_CONFIG:"update.request-config"},r={__proto__:{HOOKS:o,_hooks:{},client:null,queue:null,_resolveValidation:null,defaultParallelStatus:!0,setClient(e){this.client=e},addToQueue(){if(this.queue)return this.queue.add()},checkQueueStatus(...e){if(this.queue)return this.queue.checkIdleStatus(...e)},removeQueueRequest(e){if(this.queue)return this.queue.removeRequest(e)},setHook(e,t){return this._hooks[e]=t,this},execHook(e,...t){if(this._hooks[e])return this._hooks[e].apply(null,t)},resolveValidation(e){return!(!this._resolveValidation||"function"!=typeof this._resolveValidation)&&this._resolveValidation(e)},setResolveValidation(e){return this._resolveValidation=e,this},init(e={}){if(!e||"[object Object]"!==e.toString())throw new Error("Invalid options passed.");return e.client&&this.setClient(e.client),e.queue?(this.queue=s.getInstance(),this.queue.debugMode=!!e.queueLogs):this.queue=null,void 0!==e.defaultParallelStatus&&(this.defaultParallelStatus=Boolean(e.defaultParallelStatus)),this}}};r.setResolveValidation(e=>!!e),r.setHook(o.BEFORE_RESOLVE,e=>e),r.setHook(o.BEFORE_REJECT,e=>e),r.setHook(o.UPDATE_REQUEST_CONFIG,e=>e);class n{constructor(...e){if(this._client=r.client,!this._client||"function"!=typeof this._client)throw new Error("HTTP client must be a function");this._reqConfig=e,this._id=r.addToQueue(),this._customHooks={},this._resolveValidation=null}setClient(e){if(!e||"function"!=typeof e)throw new Error("Invalid client passed. Client must be a function");return this._client=e,this}setHook(e,t){return e&&"function"==typeof t&&(this._customHooks[e]=t),this}execHook(e,...t){return this._customHooks[e]&&"function"==typeof this._customHooks[e]?this._customHooks[e].apply(this,t):r.execHook(e,...t)}resolveValidation(e){return this._resolveValidation&&"function"==typeof this._resolveValidation?this._resolveValidation(e):r.resolveValidation(e)}setResolveValidation(e){return this._resolveValidation=e,this}fire(e={}){return this._fireOptions=e,this._fireOptions&&"object"==typeof this._fireOptions||(this._fireOptions={parallel:r.defaultParallelStatus}),this._reqConfig=[this.execHook(o.UPDATE_REQUEST_CONFIG,...this._reqConfig)],new Promise(async(e,t)=>{try{await r.checkQueueStatus(this._id,this._fireOptions.parallel),this.execHook(o.BEFORE_FIRE,this._fireOptions);const i=await this._client(...this._reqConfig);this.resolveValidation(i)?(this.execHook(o.AFTER_SUCCESS,i,this._fireOptions),e(this.execHook(o.BEFORE_RESOLVE,i,this._fireOptions))):(this.execHook(o.AFTER_FAIL,i,this._fireOptions),t(this.execHook(o.BEFORE_REJECT,i,this._fireOptions)))}catch(e){this.execHook(o.AFTER_FAIL,e,this._fireOptions),t(this.execHook(o.BEFORE_REJECT,e,this._fireOptions))}finally{r.removeQueueRequest(this._id)}})}}}])}));