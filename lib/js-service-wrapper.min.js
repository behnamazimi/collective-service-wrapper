!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).JSServiceWrapper={})}(this,(function(e){"use strict";const t=(()=>{let e;return{getInstance:()=>(e||(e={_debugMode:!1,log(...e){this._debugMode&&console.log(...e)},set debugMode(e){this._debugMode=e},count:0,_requests:{},generateNewID(){return this.count++,this.count+"__"+Math.random().toString(32).substr(2).substr(6)},onTurn(e,t){this._requests[e]={...this._requests[e],listener:t,status:"pending"}},fire(e,...t){this._requests[e]&&"function"==typeof this._requests[e].listener&&(this.log(`* FIRED: ${e} [type: ${this._requests[e].status}]`),this._requests[e].status="fired",this._requests[e].listener.apply(this,t))},add(e){let t=e;return t||(t=this.generateNewID()),this._requests[t]={},this.log("+ ADDED: "+t),t},checkIdleStatus(e,t=!1){return new Promise(s=>{if(this.onTurn(e,s),t)return this._requests[e].status="parallel",void this.fire(e);const i=Object.keys(this._requests);i.length&&i[0]!==e||this.fire(e)})},removeRequest(e){delete this._requests[e],this.log("- REMOVED: "+e);const t=Object.keys(this._requests),s=this._requests[t[0]];return s&&"pending"===s.status&&this.fire(t[0]),!0},cancelService(e){return"pending"===this._requests[e].status&&(delete this._requests[e],!0)}}),e)}})(),s={BEFORE_RESOLVE:"before.resolve",BEFORE_REJECT:"before.reject",BEFORE_FIRE:"before.fire",AFTER_SUCCESS:"after.success",AFTER_FAIL:"after.fail",UPDATE_REQUEST_CONFIG:"update.request-config"},i={__proto__:{HOOKS:s,_hooks:{},client:null,queue:null,_resolveValidation:null,defaultParallelStatus:!0,setClient(e){this.client=e},addToQueue(e){if(this.queue)return this.queue.add(e)},checkQueueStatus(...e){if(this.queue)return this.queue.checkIdleStatus(...e)},removeQueueRequest(e){if(this.queue)return this.queue.removeRequest(e)},cancelService(e){if(this.queue)return this.queue.cancelService(e)},setHook(e,t){return this._hooks[e]=t,this},execHook(e,...t){if(this._hooks[e])return this._hooks[e].apply(null,t)},resolveValidation(e){return!(!this._resolveValidation||"function"!=typeof this._resolveValidation)&&this._resolveValidation(e)},setResolveValidation(e){return this._resolveValidation=e,this},init(e={}){if(!e||"[object Object]"!==e.toString())throw new Error("Invalid options passed.");return e.client&&this.setClient(e.client),e.queue?(this.queue=t.getInstance(),this.queue.debugMode=!!e.queueLogs):this.queue=null,void 0!==e.defaultParallelStatus&&(this.defaultParallelStatus=Boolean(e.defaultParallelStatus)),this}}};i.setResolveValidation(e=>!0),i.setHook(s.BEFORE_RESOLVE,e=>e),i.setHook(s.BEFORE_REJECT,e=>e),i.setHook(s.UPDATE_REQUEST_CONFIG,e=>e);e.ClientHandler=class{constructor(...e){if(this._client=i.client,!this._client||"function"!=typeof this._client)throw new Error("HTTP client must be a function");this._reqConfig=e,this._customHooks={},this._resolveValidation=null}get id(){return this._id}addToQueue(e){this._id=i.addToQueue(e)}cancel(){return!(!this._fireOptions||this._fireOptions.parallel)&&i.removeQueueRequest(this._id)}setClient(e){if(!e||"function"!=typeof e)throw new Error("Invalid client passed. Client must be a function");return this._client=e,this}setHook(e,t){return e&&"function"==typeof t&&(this._customHooks[e]=t),this}execHook(e,...t){return this._customHooks[e]&&"function"==typeof this._customHooks[e]?this._customHooks[e].apply(this,t):i.execHook(e,...t)}resolveValidation(e){return this._resolveValidation&&"function"==typeof this._resolveValidation?this._resolveValidation(e):i.resolveValidation(e)}setResolveValidation(e){return this._resolveValidation=e,this}fire(e={}){return this._fireOptions=e,this._fireOptions&&"object"==typeof this._fireOptions||(this._fireOptions={parallel:i.defaultParallelStatus}),this.addToQueue(this._fireOptions.id),this._reqConfig=[this.execHook(s.UPDATE_REQUEST_CONFIG,...this._reqConfig)],new Promise(async(e,t)=>{try{await i.checkQueueStatus(this._id,this._fireOptions.parallel),this.execHook(s.BEFORE_FIRE,this._fireOptions);const o=await this._client(...this._reqConfig);this.resolveValidation(o)?(this.execHook(s.AFTER_SUCCESS,o,this._fireOptions),e(this.execHook(s.BEFORE_RESOLVE,o,this._fireOptions))):(this.execHook(s.AFTER_FAIL,o,this._fireOptions),t(this.execHook(s.BEFORE_REJECT,o,this._fireOptions)))}catch(e){this.execHook(s.AFTER_FAIL,e,this._fireOptions),t(this.execHook(s.BEFORE_REJECT,e,this._fireOptions))}finally{i.removeQueueRequest(this._id)}})}},e.HOOKS=s,e.ServiceWrapper=i,Object.defineProperty(e,"__esModule",{value:!0})}));
